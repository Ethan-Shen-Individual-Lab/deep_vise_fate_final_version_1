<!DOCTYPE html>
<html lang="zh">
<head>
    <title>联邦学习预测性维护系统</title>
    <link rel="stylesheet" href="top-bar.css">
    <script src="top-bar.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        .title {
            font-size: 36px;             /* Large font size */
            font-weight: bold;           /* Make the title bold */
            color: #000000;              /* Dark grey color for readability */
            text-align: center;          /* Center the title */
            margin-top: -50px;            /* Add space above the title */
            margin-bottom: 20px;         /* Add space below the title */
            font-family: 'Arial', sans-serif; /* Clean and modern font */
            text-transform: uppercase;   /* Make the title uppercase */
            letter-spacing: 2px;         /* Add letter spacing for a more spacious look */
            border-bottom: 3px solid #8f3487; /* Add a decorative underline */
            padding-bottom: 10px;        /* Add padding below the title */
        }
        body {
            font-family: Arial, sans-serif;
            background: #f0f2f5;
            color: #333;
        }
        a.return-link {
            position: fixed;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 0.8em;
            text-decoration: none;
            z-index: 24;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 5px;
        }

        .panel {
            top: -280px;
            background-color: white;
            padding: 20px;
            margin: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }
        .nav-buttons {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 3;
        }
        .nav-button {
            background-color: transparent;
            color: rgb(0, 0, 0);
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .nav-button:hover {
            background-color: rgba(255, 255, 255, 0.65);
        }
        .nav-button-special{
            background-color: rgba(255, 255, 255, 0.65);
            color: rgb(0, 0, 0);
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        /* 添加自定义的多选行为样式 */
        .feature-select[multiple]:focus option:checked {
            background-color: #f0f0f0 !important;
            color: #333;
        }
        .logo {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 24;
        }
        .logo img {
            width: 100px; /* 调整图标大小 */
            height: auto;
        }
        .video-background {
            position: relative;
            top: -10vh;
            left: 0;
            width: 100%;
            height: 79vh;
            object-fit: cover;
            z-index: 0;
        }
        .option-text {
            color: #1a73e8;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8f0fe;
        }
        /* 添加相关样式 */
        .monitoring-section, .risk-assessment, .loan-info, .adjustment-controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .health-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        .metric {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-indicator.normal { background-color: #28a745; }
        .status-indicator.warning { background-color: #ffc107; }
        .status-indicator.danger { background-color: #dc3545; }

        .risk-level .level {
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        .level.warning {
            background-color: #fff3cd;
            color: #856404;
        }

        .suggestion-item {
            margin: 10px 0;
        }

        .value.increase { color: #dc3545; }
        .value.decrease { color: #28a745; }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .adjustment-form {
            display: grid;
            gap: 15px;
        }

        .form-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group input {
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }

        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .submit-btn, .accept-btn, .reject-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .submit-btn {
            background-color: #007bff;
            color: white;
        }

        .accept-btn {
            background-color: #28a745;
            color: white;
        }

        .reject-btn {
            background-color: #dc3545;
            color: white;
        }

        h3 {
            color: #333;
            margin-bottom: 15px;
        }

        h4 {
            color: #666;
            margin: 10px 0;
        }

        #login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 23;
        }

        .login-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-align: center;
            width: 400px;
            z-index: 23;
        }

        /* 保持视频背景和其他UI元素可见 */
        .video-background, .top-bar, .logo, .return-link, .title {
            display: block !important;
        }

        /* 隐藏功能面板 */
        #main-content .panel {
            display: none;
        }

        /* 登录框样式 */
        .login-box h2 {
            color: #1a73e8;
            font-size: 23px;
            margin-bottom: 30px;
        }

        .identity-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .identity-buttons button {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            background: #4a90e2;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .identity-buttons button:hover {
            background: #357abd;
        }

        #login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        #login-form input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        #login-form button {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            background: #4caf50;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        #login-form button:hover {
            background: #45a049;
        }

        .error-message {
            color: #ff4444;
            margin-top: 10px;
            font-size: 14px;
        }

        /* 设备监控样式 */
        .device-metrics {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .metric-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .metric-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-light {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-light.normal { background-color: #28a745; }
        .status-light.warning { background-color: #ffc107; }
        .status-light.severe { background-color: #dc3545; }

        /* 预警通知样式 */
        .warning-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .warning-item {
            padding: 15px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .warning-item.severe { border-left: 4px solid #dc3545; }
        .warning-item.warning { border-left: 4px solid #ffc107; }

        .warning-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .send-notice-btn {
            margin-top: 10px;
            padding: 5px 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* 调整建议样式 */
        .adjustment-recommendations {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .risk-level.high {
            color: #dc3545;
            font-weight: bold;
        }

        .apply-adjustment-btn {
            margin-top: 15px;
            padding: 8px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* 管理措施样式 */
        .action-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }

        .action-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .execute-action-btn {
            padding: 8px 16px;
            background: #17a2b8;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* 资产概览样式 */
        .asset-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 15px;
        }

        .asset-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .asset-label {
            display: block;
            color: #666;
            margin-bottom: 5px;
        }

        .asset-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #1a73e8;
        }

        /* 企业贷款管理样式 */
        .enterprise-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        .enterprise-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .enterprise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .loan-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .loan-status.normal { 
            background: #e8f5e9;
            color: #2e7d32;
        }

        .loan-status.warning {
            background: #fff3e0;
            color: #e65100;
        }

        .loan-details {
            margin: 10px 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            color: #666;
        }

        /* 调整建议样式 */
        .recommendation-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .recommendation-item.warning {
            border-left: 4px solid #ff9800;
        }

        .recommendation-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .recommendation-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .recommendation-reason {
            margin: 10px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }

        /* 审批记录样式 */
        .history-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .approval-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .approval-status.approved {
            background: #e8f5e9;
            color: #2e7d32;
        }

        button {
            background: #1a73e8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background: #1557b0;
        }

        /* 交互历史记录样式 */
        .interaction-history {
            margin-bottom: 30px;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .history-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .history-item:hover {
            transform: translateY(-2px);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #666;
        }

        .history-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .status.approved {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status.pending {
            background: #fff3e0;
            color: #e65100;
        }

        .status.completed {
            background: #e3f2fd;
            color: #1565c0;
        }

        /* 当前贷款合同样式 */
        .contract-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .contract-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .contract-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .enterprise-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #1a73e8;
        }

        .contract-id {
            color: #666;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
        }

        .view-detail-btn {
            margin-top: 15px;
            padding: 8px 16px;
            background: #1a73e8;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .view-detail-btn:hover {
            background: #1557b0;
        }

        /* 企业用户界面样式 */
        .enterprise-content {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .loan-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        .notice-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .notice-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .notice-actions button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .notice-actions button:first-child {
            background: #28a745;
            color: white;
        }

        .notice-actions button:last-child {
            background: #dc3545;
            color: white;
        }

        .monitor-btn {
            margin-top: 15px;
            padding: 10px 20px;
            background: #1a73e8;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }

        .monitor-btn:hover {
            background: #1557b0;
        }

        .asset-status-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .device-status {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .status-item {
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section {
            background-color: white;
            padding: 25px;
            margin: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #333;
            font-size: 1.5em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #8f3487;
        }

        .feature-selection {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .standard-model-option {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .btn-secondary {
            background-color: #8f3487;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn-secondary:hover {
            background-color: #7a2c73;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .feature-select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }

        .feature-select[multiple] {
            height: 200px;
        }

        .form-text {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.9em;
        }

        .feature-select-wrapper {
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        .section {
            background: #fff;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #1a73e8;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8f0fe;
        }

        /* 联邦学习信用凭证样式 */
        .federal-learning-credit {
            background-color: #e8f0fe;  /* 浅蓝色背景 */
            border: 2px solid #1a73e8;  /* 蓝色边框 */
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(26, 115, 232, 0.1);
            transition: all 0.3s ease;
        }

        .federal-learning-credit:hover {
            box-shadow: 0 6px 10px rgba(26, 115, 232, 0.2);
            transform: translateY(-3px);
        }

        .federal-learning-credit h3 {
            color: #1a73e8;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 600;
            border-bottom: 2px solid #1a73e8;
            padding-bottom: 10px;
        }

        .federal-learning-credit .btn-primary {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .federal-learning-credit .btn-primary:hover {
            background-color: #185abc;
            transform: scale(1.05);
        }

        .credit-result {
            margin-top: 20px;
            background-color: white;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .credit-result .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px;
            background-color: #f6f8fa;
            border-radius: 6px;
            transition: background-color 0.3s ease;
        }

        .credit-result .result-item:hover {
            background-color: #e9ecef;
        }

        .credit-result .result-label {
            color: #1a73e8;
            font-weight: 500;
            font-size: 0.9em;
        }

        .credit-result .result-value {
            color: #185abc;
            font-weight: bold;
            font-size: 1.1em;
        }

        #credit-training-status {
            margin-top: 15px;
            background-color: #f1f6ff;
            border-radius: 8px;
            padding: 15px;
        }

        #credit-training-status .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #1a73e8;
        }

        #credit-training-status .status-label {
            color: #185abc;
            font-weight: 500;
        }

        #credit-training-status .status-value {
            color: #1a73e8;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e1e4e8;
            border-radius: 4px;
            overflow: hidden;
        }

        #credit-training-progress {
            width: 0%;
            height: 100%;
            background-color: #1a73e8;
            transition: width 0.5s ease;
        }
    </style>
</head>
<div class="to-llm" onclick="window.location.href='LLM.html'">
    <span class="to-llm-text">智能管家</span>
</div>
<body>
    <!-- 登录框 -->
    <div id="login-container" style="display: block;">
        <div class="login-box">
            <h2>请选择您的身份</h2>
            <div class="identity-buttons">
                <button onclick="selectIdentity('enterprise')">我是企业，需要贷款</button>
                <button onclick="selectIdentity('institution')">我是机构，需要管理资产</button>
            </div>
            <div id="login-form" style="display: none;">
                <input type="text" id="username" placeholder="请输入账号">
                <input type="password" id="password" placeholder="请输入密码">
                <button onclick="login()">登录</button>
            </div>
        </div>
    </div>

    <!-- 顶部导航栏 -->
    <div class="top-bar">
        <div class="nav-buttons">
            <div>
                <button class="nav-button" onclick="window.location.href='intro.html'" onmouseover="expandTopBar(this)">首页</button>
                <div class="sub-menu">
                    <a href="intro.html#main3">产品功能介绍</a>
                    <a href="intro.html#mainContent">技术亮点</a>
                    <a href="intro.html#mainContent">金融生态</a>
                    <a href="intro.html#mainContent">应用场景</a>
                    <a href="intro.html#mainContent">开发团队介绍</a>
                </div>
            </div>
            <div>
                <button class="nav-button" onclick="window.location.href='health_monitor.html'" onmouseover="expandTopBar(this)">采集与监控</button>
                <div class="sub-menu">
                    <a href="health_monitor.html">实时状态监控</a>
                    <a href="health_monitor.html">健康评分</a>
                    <a href="health_monitor.html">异常检测</a>
                    <a href="health_monitor.html">联邦学习设备状态识别</a>
                </div>
            </div>
            
            <div>
                <button class="nav-button" onclick="window.location.href='federal_learning.html'" onmouseover="expandTopBar(this)">联邦学习</button>
                <div class="sub-menu">
                </div>
            </div>
            <div>
                <button class="nav-button" onclick="window.location.href='quality_control_defect_prediction.html'" onmouseover="expandTopBar(this)">双向金融</button>
                <div class="sub-menu">
                    <a href="quality_control_defect_prediction.html">我是企业，需要贷款</a>
                    <a href="quality_control_defect_prediction.html">我是机构，需要管理资产</a>
                </div>
            </div>
            <div>
                <button class="nav-button" onclick="window.location.href='maintenance_optimization.html'" onmouseover="expandTopBar(this)">可视化</button>
                <div class="sub-menu">
                    <a href="maintenance_optimization.html">设备健康状态可视化</a>
                    <a href="maintenance_optimization.html">FATE联邦学习分析</a>
                    <a href="maintenance_optimization.html">数据统计分析</a>
                </div>
            </div>
            <div>
                <button class="nav-button" onclick="window.location.href='privacy_security_management.html'" onmouseover="expandTopBar(this)">数据安全</button>
                <div class="sub-menu">
                    <a href="privacy_security_management.html">数据保护概览</a>
                    <a href="privacy_security_management.html">数据安全配置</a>
                    <a href="privacy_security_management.html">合规审计日志</a>
                </div>
            </div>
        </div>
    </div>

    <!-- 视频背景 -->
    <video class="video-background" id="video_mp4" autoplay muted loop>
        <source src="figures/9.mp4" type="video/mp4">
        您的浏览器不支持视频标签。
    </video>

    <!-- Logo和返回按钮 -->
    <div class="logo">
        <img src="figures/7.png" alt="Logo">
    </div>
    <a href="index.html" class="return-link">返回</a>  

    <!-- 标题 -->
    <div class="title">
        机构与企业间双向金融信息打通
    </div>

    <!-- 功能面板 -->
    <div class="panel" id="panel" style="display: none;">
        <div class="option-text">贷款额度与利率动态调整</div>
        
        <!-- 贷款资产概览 -->
        <div class="asset-overview">
            <h3>贷款资产概览</h3>
            <div class="asset-grid">
                <div class="asset-item">
                    <span class="asset-label">总贷款规模</span>
                    <span class="asset-value">¥8,500万</span>
                </div>
                <div class="asset-item">
                    <span class="asset-label">平均贷款利率</span>
                    <span class="asset-value">4.85%</span>
                </div>
                <div class="asset-item">
                    <span class="asset-label">贷款企业数量</span>
                    <span class="asset-value">12家</span>
                </div>
            </div>
        </div>

        <!-- 企业贷款管理 -->
        <div class="loan-management">
            <h3>企业贷款管理</h3>
            <div class="enterprise-list">
                <div class="enterprise-item">
                    <div class="enterprise-header">
                        <span class="enterprise-name">企业A</span>
                        <span class="loan-status normal">正常</span>
                    </div>
                    <div class="loan-details">
                        <div class="detail-row">
                            <span>当前额度：500万</span>
                            <span>当前利率：4.65%</span>
                        </div>
                        <div class="detail-row">
                            <span>设备状态：良好</span>
                            <span>信用评级：A</span>
                        </div>
                    </div>
                    <div class="adjustment-controls">
                        <button onclick="showAdjustmentDialog('A', 500, 4.65)">调整贷款条件</button>
                    </div>
                </div>

                <div class="enterprise-item">
                    <div class="enterprise-header">
                        <span class="enterprise-name">企业B</span>
                        <span class="loan-status warning">需关注</span>
                    </div>
                    <div class="loan-details">
                        <div class="detail-row">
                            <span>当前额度：300万</span>
                            <span>当前利率：5.15%</span>
                        </div>
                        <div class="detail-row">
                            <span>设备状态：需维护</span>
                            <span>信用评级：B+</span>
                        </div>
                    </div>
                    <div class="adjustment-controls">
                        <button onclick="showAdjustmentDialog('B', 300, 5.15)">调整贷款条件</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 贷款调整建议 -->
        <div class="adjustment-recommendations">
            <h3>系统调整建议</h3>
            <div class="recommendation-list">
                <div class="recommendation-item warning">
                    <div class="recommendation-header">
                        <span>企业B - 建议调整</span>
                        <span class="timestamp">2024-01-20</span>
                    </div>
                    <div class="recommendation-content">
                        <p>建议措施：</p>
                        <ul>
                            <li>下调贷款额度至250万</li>
                            <li>上调利率0.5个百分点</li>
                            <li>要求追加设备维护保证金</li>
                        </ul>
                        <div class="recommendation-reason">
                            原因：设备状态下降，维护不及时
                        </div>
                        <button onclick="applyRecommendation('B')">应用建议</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 调整审批记录 -->
        <div class="adjustment-history">
            <h3>调整审批记录</h3>
            <div class="history-list">
                <div class="history-item">
                    <div class="history-header">
                        <span>企业C</span>
                        <span class="approval-status approved">已通过</span>
                    </div>
                    <div class="history-content">
                        <p>调整内容：额度下调至600万，利率上调0.3%</p>
                        <p>审批时间：2024-01-15</p>
                        <p>生效状态：已执行</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="panel" id="panel">
        <div class="option-text">实时风险预警与预防措施</div>
        
        <!-- 资产质量监控 -->
        <div class="monitoring-section">
            <h3>企业资产质量监控</h3>
            <div class="device-metrics">
                <div class="metric-group">
                    <div class="metric-item">
                        <span class="metric-label">企业A设备状态</span>
                        <span class="metric-value">正常运行</span>
                        <span class="asset-value">设备价值: 500万</span>
                        <div class="status-light normal"></div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">企业B设备状态</span>
                        <span class="metric-value">需要维护</span>
                        <span class="asset-value">设备价值: 300万</span>
                        <div class="status-light warning"></div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">企业C设备状态</span>
                        <span class="metric-value">严重故障</span>
                        <span class="asset-value">设备价值: 800万</span>
                        <div class="status-light severe"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 风险预警系统 -->
        <div class="warning-section">
            <h3>机构风险预警</h3>
            <div class="warning-list">
                <div class="warning-item severe">
                    <div class="warning-header">
                        <span class="warning-level">高风险预警</span>
                        <span class="warning-time">2024-01-20 14:30</span>
                    </div>
                    <div class="warning-content">
                        企业C的核心设备出现严重故障，可能影响还款能力
                        <div class="risk-details">
                            <p>涉及贷款金额：800万</p>
                            <p>预计影响：还款能力显著下降</p>
                        </div>
                        <button class="send-notice-btn" onclick="reportToBank('C-001', 'severe')">上报银行</button>
                    </div>
                </div>
                <div class="warning-item warning">
                    <div class="warning-header">
                        <span class="warning-level">中等风险预警</span>
                        <span class="warning-time">2024-01-20 14:25</span>
                    </div>
                    <div class="warning-content">
                        企业B的设备性能下降，建议关注
                        <div class="risk-details">
                            <p>涉及贷款金额：300万</p>
                            <p>预计影响：需要增加监管频率</p>
                        </div>
                        <button class="send-notice-btn" onclick="reportToBank('B-002', 'warning')">记录风险</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 风险评估报告 -->
        <div class="risk-report-section">
            <h3>机构风险评估报告</h3>
            <div class="report-content">
                <div class="risk-summary">
                    <h4>当前风险状况</h4>
                    <div class="risk-stats">
                        <div class="stat-item">
                            <span>总贷款资产：2600万</span>
                        </div>
                        <div class="stat-item">
                            <span>风险资产占比：31%</span>
                        </div>
                        <div class="stat-item">
                            <span>预警资产数：2个</span>
                        </div>
                    </div>
                </div>
                <button class="generate-report-btn" onclick="generateRiskReport()">生成详细报告</button>
            </div>
        </div>

        <!-- 风险管理措施 -->
        <div class="management-section">
            <h3>风险管理措施</h3>
            <div class="management-actions">
                <div class="action-item">
                    <h4>建议采取的措施</h4>
                    <div class="action-list">
                        <label class="action-checkbox">
                            <input type="checkbox" onchange="updateAction(this)">
                            增加企业C的实地检查频率
                        </label>
                        <label class="action-checkbox">
                            <input type="checkbox" onchange="updateAction(this)">
                            要求企业B提供设备维护计划
                        </label>
                        <label class="action-checkbox">
                            <input type="checkbox" onchange="updateAction(this)">
                            向上级银行报备高风险资产情况
                        </label>
                    </div>
                    <button class="execute-action-btn" onclick="executeActions()">执行选中的措施</button>
                </div>
            </div>
        </div>
    </div>

    <div class="panel" id="panel">
        <div class="option-text">金融交互记录</div>
        
        <!-- 交互历史记录 -->
        <div class="interaction-history">
            <h3>交互历史记录</h3>
            <div class="history-list">
                <div class="history-item" onclick="showInteractionDetail('INT001')">
                    <div class="history-header">
                        <span class="timestamp">2024-01-20 15:30</span>
                        <span class="interaction-type">贷款条件调整</span>
                    </div>
                    <div class="history-summary">
                        <span class="enterprise">企业A</span>
                        <span class="action">贷款额度调整为500万</span>
                        <span class="status approved">已确认</span>
                    </div>
                </div>

                <div class="history-item" onclick="showInteractionDetail('INT002')">
                    <div class="history-header">
                        <span class="timestamp">2024-01-19 14:20</span>
                        <span class="interaction-type">风险预警通知</span>
                    </div>
                    <div class="history-summary">
                        <span class="enterprise">企业B</span>
                        <span class="action">设备状态异常预警</span>
                        <span class="status pending">待处理</span>
                    </div>
                </div>

                <div class="history-item" onclick="showInteractionDetail('INT003')">
                    <div class="history-header">
                        <span class="timestamp">2024-01-18 09:15</span>
                        <span class="interaction-type">合同更新</span>
                    </div>
                    <div class="history-summary">
                        <span class="enterprise">企业C</span>
                        <span class="action">利率调整协议签署</span>
                        <span class="status completed">已完成</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 当前贷款合同展示 -->
        <div class="current-contracts">
            <h3>当前贷款合同</h3>
            <div class="contract-list">
                <div class="contract-item">
                    <div class="contract-header">
                        <span class="enterprise-name">企业A</span>
                        <span class="contract-id">合同号：CTR2024001</span>
                    </div>
                    <div class="contract-details">
                        <div class="detail-row">
                            <span class="label">贷款额度：</span>
                            <span class="value">500万元</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">当前利率：</span>
                            <span class="value">4.65%</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">还款期限：</span>
                            <span class="value">2024-01-20 至 2025-01-19</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">还款方式：</span>
                            <span class="value">等额本息</span>
                        </div>
                        <button class="view-detail-btn" onclick="viewContractDetail('CTR2024001')">查看完整合同</button>
                    </div>
                </div>

                <div class="contract-item">
                    <div class="contract-header">
                        <span class="enterprise-name">企业B</span>
                        <span class="contract-id">合同号：CTR2024002</span>
                    </div>
                    <div class="contract-details">
                        <div class="detail-row">
                            <span class="label">贷款额度：</span>
                            <span class="value">300万元</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">当前利率：</span>
                            <span class="value">5.15%</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">还款期限：</span>
                            <span class="value">2024-01-15 至 2025-01-14</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">还款方式：</span>
                            <span class="value">等额本金</span>
                        </div>
                        <button class="view-detail-btn" onclick="viewContractDetail('CTR2024002')">查看完整合同</button>
                    </div>
                </div>
            </div>
              
        </div>


    </div>

    

    <script>
        let selectedIdentity = '';

        function selectIdentity(identity) {
            selectedIdentity = identity;
            document.getElementById('login-form').style.display = 'flex';
            
            // 更新按钮样式以显示选中状态
            const buttons = document.querySelectorAll('.identity-buttons button');
            buttons.forEach(button => {
                if (button.textContent.includes(identity === 'enterprise' ? '企业' : '机构')) {
                    button.style.background = '#45a049';
                } else {
                    button.style.background = '#4a90e2';
                }
            });
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username && password) {
                // 隐藏登录界面
                document.getElementById('login-container').style.display = 'none';
                
                // 如果是企业用户，显示联邦学习信用凭证功能
                if (selectedIdentity === 'enterprise') {
                    // 添加联邦学习信用凭证功能区
                    const creditSection = document.createElement('div');
                    creditSection.className = 'section';
                    creditSection.innerHTML = `
                        <h2>联邦学习信用凭证</h2>
                        <div class="credit-section">
                            <div class="model-selection">
                                <button id="standard-model-btn" class="btn-secondary">使用标准模型</button>
                                <small class="form-text">使用标准模型评估企业信用状况</small>
                            </div>
                            
                            <div id="training-status" style="display: none;">
                                <div class="status-item">
                                    <span class="status-label">训练任务ID:</span>
                                    <span class="status-value" id="taskId">--</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">当前任务执行时间:</span>
                                    <span class="status-value" id="elapsedTime">--</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">任务状态:</span>
                                    <span class="status-value" id="status">等待中</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div id="training-progress" class="progress-bar"></div>
                                </div>
                            </div>

                            <div class="action-buttons" style="display: none;">
                                <button id="start-training" class="btn-primary" disabled>开始训练</button>
                            </div>

                            <div id="credit-results" style="display: none;">
                                <div class="results-grid">
                                    <div class="result-item">
                                        <span class="result-label">设备损坏比例:</span>
                                        <span class="result-value damage-rate">0%</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">设备与财务综合指数:</span>
                                        <span class="result-value composite-score">90</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">建议贷款额度:</span>
                                        <span class="result-value loan-amount">500万</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // 将新功能区添加到页面底部
                    document.body.appendChild(creditSection);

                    // 添加事件监听器
                    document.getElementById('standard-model-btn').addEventListener('click', function() {
                        document.getElementById('training-status').style.display = 'block';
                        document.querySelector('.action-buttons').style.display = 'block';
                        document.getElementById('start-training').disabled = false;
                    });

                    document.getElementById('start-training').addEventListener('click', function() {
                        // 更新初始状态
                        document.getElementById('taskId').textContent = ++currentTaskId;
                        document.getElementById('elapsedTime').textContent = '0秒';
                        document.getElementById('status').textContent = '执行中';
                        document.getElementById('training-progress').style.width = '0%';

                        // 模拟进度条
                        let progress = 0;
                        const progressInterval = setInterval(() => {
                            progress += 2;
                            if (progress <= 100) {
                                document.getElementById('training-progress').style.width = progress + '%';
                                document.getElementById('elapsedTime').textContent = Math.floor(progress/10) + '秒';
                            }
                        }, 200);

                        // 直接显示成功结果
                        setTimeout(() => {
                            clearInterval(progressInterval);
                            
                            // 更新状态为完成
                            document.getElementById('training-progress').style.width = '100%';
                            document.getElementById('status').textContent = '已完成';

                            // 显示结果
                            document.getElementById('credit-results').style.display = 'block';
                            
                            // 设置固定的成功结果
                            document.querySelector('.damage-rate').textContent = '0%';
                            document.querySelector('.composite-score').textContent = '90';
                            document.querySelector('.loan-amount').textContent = '500万';

                            // 添加生成凭证按钮
                            const generateButton = document.createElement('button');
                            generateButton.className = 'btn-primary';
                            generateButton.style.marginTop = '20px';
                            generateButton.textContent = '生成信用凭证';
                            generateButton.onclick = function() {
                                // 显示凭证内容
                                const certificateContent = `
                                    <div class="credit-certificate" style="margin-top: 20px; padding: 20px; border: 2px solid #1a73e8; border-radius: 8px; background: #f8f9fa;">
                                        <h4 style="color: #1a73e8; margin-bottom: 15px;">联邦学习信用凭证</h4>
                                        <div style="margin-bottom: 10px;">
                                            <strong>凭证编号：</strong> FL-${currentTaskId}-${Date.now()}
                                        </div>
                                        <div style="margin-bottom: 10px;">
                                            <strong>评估时间：</strong> ${new Date().toLocaleString()}
                                        </div>
                                        <div style="margin-bottom: 10px;">
                                            <strong>设备损坏比例：</strong> 0%
                                        </div>
                                        <div style="margin-bottom: 10px;">
                                            <strong>综合信用指数：</strong> 90
                                        </div>
                                        <div style="margin-bottom: 10px;">
                                            <strong>建议贷款额度：</strong> 500万
                                        </div>
                                        <div style="margin-top: 15px; font-size: 0.9em; color: #666;">
                                            本凭证由联邦学习系统生成，仅供参考
                                        </div>
                                    </div>
                                `;
                                
                                // 将凭证添加到结果区域后面
                                document.getElementById('credit-results').insertAdjacentHTML('afterend', certificateContent);
                                
                                // 禁用生成按钮，防止重复生成
                                generateButton.disabled = true;
                                generateButton.textContent = '已生成凭证';
                            };
                            
                            // 将按钮添加到结果区域
                            document.getElementById('credit-results').appendChild(generateButton);
                        }, 5000);
                    });
                }
                
                // 显示主要内容
                document.querySelectorAll('.panel').forEach(panel => {
                    panel.style.display = 'block';
                });
            } else {
                alert('请输入用户名和密码');
            }
        }

        // 企业用户的功能函数
        function acceptAdjustment() {
            if(confirm('确认接受此次调整方案？')) {
                alert('已接受调整方案，新的贷款条件将立即生效');
            }
        }

        function rejectAdjustment() {
            const reason = prompt('请输入拒绝原因：');
            if(reason) {
                alert('已拒绝调整方案，您的反馈已发送给机构');
            }
        }

        function acknowledgeWarning(warningId) {
            alert('已确认收到预警通知，将立即安排处理');
        }

        // 页面加载时的处理
        document.addEventListener('DOMContentLoaded', function() {
            // 只隐藏功能面板
            document.querySelectorAll('.panel').forEach(panel => {
                panel.style.display = 'none';
            });
        });

        // 添加一个全局变量来跟踪任务ID
        let currentTaskId = 0;

        // 监听隐私设置变化
        document.getElementById('privacy-budget').addEventListener('input', function(e) {
            document.getElementById('privacy-budget-value').textContent = e.target.value;
        });

        // 修改页面加载时的初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 获取初始数据
            fetchHostStatus();  // 获取本地数据状态
            fetchGuestNodesCount();  // 获取外部节点数据
            
            // 获取初始数据源选择
            const initialDataSource = document.querySelector('input[name="data-source"]:checked').value;
            updateParameterDisplay(initialDataSource);
        });

        // 修改获取本地数据状态的函数
        async function fetchHostStatus() {
            try {
                const response = await fetch('/api/host-status');
                const data = await response.json();
                // 直接显示数值，不使用占位符
                document.getElementById('local-node-count').textContent = `${data.node_counts}个`;
                document.getElementById('local-data-count').textContent = `${data.data_counts}条`;
            } catch (error) {
                console.error('获取本地数据状态失败:', error);
                document.getElementById('local-node-count').textContent = '获取失败';
                document.getElementById('local-data-count').textContent = '获取失败';
            }
        }

        // 修改获取外部节点数的函数
        async function fetchGuestNodesCount() {
            try {
                const response = await fetch('/api/guest-nodes-count');
                const data = await response.json();
                // 直接显示数值，不使用占位符
                document.getElementById('guest-nodes').textContent = `${data.count}个`;
                document.getElementById('guest-data-count').textContent = `${data.data_counts}条`;
            } catch (error) {
                console.error('获取外部节点数据失败:', error);
                document.getElementById('guest-nodes').textContent = '获取失败';
                document.getElementById('guest-data-count').textContent = '获取失败';
            }
        }

        // 修改数据源选择的处理函数
        function updateParameterDisplay(dataSource) {
            // 始终获取本地数据状态
            fetchHostStatus();
            // 始终获外部节点数
            fetchGuestNodesCount();
        }

        // 监听数据源选择化
        document.querySelectorAll('input[name="data-source"]').forEach(radio => {
            radio.addEventListener('change', function(e) {
                updateParameterDisplay(e.target.value);
            });
        });

        // 修改获取特征列表的函数
        async function fetchFeatures() {
            try {
                const response = await fetch('/api/features');
                const data = await response.json();
                const labelSelect = document.getElementById('label-feature');
                const independentSelect = document.getElementById('independent-features');
                
                // 清空现有选项
                labelSelect.innerHTML = '<option value="" disabled selected>请选择标签变量</option>';
                independentSelect.innerHTML = '<option value="" disabled>请选择自变量</option>';
                
                if (data.success && data.features) {
                    // 添加特征选项
                    data.features.forEach(feature => {
                        // 为标签变量添加选项
                        const labelOption = document.createElement('option');
                        labelOption.value = feature;
                        labelOption.textContent = feature;
                        labelSelect.appendChild(labelOption);
                        
                        // 为自变量添加选项
                        const independentOption = document.createElement('option');
                        independentOption.value = feature;
                        independentOption.textContent = feature;
                        // 设置选项的属性以支持多选
                        independentOption.setAttribute('role', 'option');
                        independentOption.setAttribute('aria-selected', 'false');
                        independentSelect.appendChild(independentOption);
                    });

                    // 添加多选支持
                    independentSelect.addEventListener('mousedown', function(e) {
                        e.preventDefault();
                        
                        const option = e.target;
                        if (option.tagName === 'OPTION' && !option.disabled) {
                            option.selected = !option.selected;  // 切换选中状态
                            
                            // 触发change事件
                            const event = new Event('change');
                            this.dispatchEvent(event);
                        }
                    });
                }
            } catch (error) {
                console.error('获取特征列表失败:', error);
            }
        }

        // 修改创建项目按钮的点击事件处理函数
        document.getElementById('create-project').addEventListener('click', async function() {
            const selectedDataSource = document.querySelector('input[name="data-source"]:checked').value;
            
            if (confirm(`确定要使用${selectedDataSource === 'local' ? '本地数据' : '联邦数据'}创建新的学习项目吗？`)) {
                // 如果选择了联邦数据，连接FATE
                if (selectedDataSource === 'federated') {
                    try {
                        // 显示连接状态
                        const statusDiv = document.createElement('div');
                        statusDiv.style.color = '#000000';  // 改为黑色字体
                        statusDiv.style.marginTop = '10px';
                        statusDiv.textContent = '正在连接FATE服务器...';
                        this.parentNode.appendChild(statusDiv);

                        // 调用后端API连接FATE
                        const response = await fetch('/api/connect_fate', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                mode: 'federated'
                            })
                        });

                        if (!response.ok) {
                            throw new Error('连接FATE失败');
                        }

                        const data = await response.json();
                        
                        // 更新连接状态
                        statusDiv.textContent = '已成功连接FATE服务器';
                        statusDiv.style.color = '#00ff00';

                        // 延迟一秒后显示其他配置选项
                        setTimeout(() => {
                            document.getElementById('additional-sections').style.display = 'block';
                            this.disabled = true;
                            fetchFeatures();
                        }, 1000);

                    } catch (error) {
                        console.error('连接FATE出错:', error);
                        alert('连接FATE服务器失败，请检查网络连接后重试');
                        return;
                    }
                } else {
                    // 如果是本地数据，直接显示配置选项
                    document.getElementById('additional-sections').style.display = 'block';
                    this.disabled = true;
                    fetchFeatures();
                }
                
                // 根据数据源类型显示/隐藏节点配置
                const nodeConfigItem = document.querySelector('.config-item:first-child');
                nodeConfigItem.style.display = selectedDataSource === 'federated' ? 'block' : 'none';
            }
        });

        // 修改验证函数，包含自变量的验证
        function validateInputs() {
            const labelFeature = document.getElementById('label-feature').value;
            const independentFeatures = Array.from(
                document.getElementById('independent-features').selectedOptions
            ).map(option => option.value);
            
            // 获取所有必填字段
            const nodeCount = document.getElementById('node-count').value;
            const minData = document.getElementById('min-data').value;
            const epochs = document.getElementById('epochs').value;
            const learningRate = document.getElementById('learning-rate').value;
            const modelType = document.getElementById('model-type').value;
            const hiddenLayers = document.getElementById('hidden-layers').value;
            const privacyBudget = document.getElementById('privacy-budget').value;
            const noiseMechanism = document.getElementById('noise-mechanism').value;
            const dataSensitivity = document.getElementById('data-sensitivity').value;

            // 检查是否至少选择了一个自变量
            const isValid = labelFeature && independentFeatures.length > 0 && nodeCount && minData && epochs && 
                           learningRate && modelType && hiddenLayers && 
                           privacyBudget && noiseMechanism && dataSensitivity;

            // 启用或禁用开始训练按钮
            document.getElementById('start-training').disabled = !isValid;
        }

        // 为所有输入字段添加验证监听
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('change', validateInputs);
            element.addEventListener('input', validateInputs);
        });

        // 在页面加载时进行始验证
        document.addEventListener('DOMContentLoaded', validateInputs);

        // 为特征选择添加验证监听
        document.getElementById('label-feature').addEventListener('change', validateInputs);

        // 为自变量选择添加验证监听
        document.getElementById('independent-features').addEventListener('change', validateInputs);

        // 修改取消按钮的处函数
        document.getElementById('cancel-config').addEventListener('click', function() {
            document.getElementById('additional-sections').style.display = 'none';
            document.getElementById('create-project').disabled = false;
            
            // 重置特征选择
            document.getElementById('label-feature').selectedIndex = 0;
            
            // 重置自变量选择
            const independentSelect = document.getElementById('independent-features');
            Array.from(independentSelect.options).forEach(option => {
                option.selected = false;
            });
            
            // 清空所有输入字段的值
            document.querySelectorAll('input, select').forEach(element => {
                if (element.type === 'number' || element.type === 'select-one') {
                    element.value = element.defaultValue;
                } else if (element.type === 'range') {
                    element.value = 1.0;
                    document.getElementById('privacy-budget-value').textContent = '1.0';
                }
            });
            
            // 重置训练状态
            document.getElementById('taskId').textContent = '0';
            document.getElementById('elapsedTime').textContent = '--';
            document.getElementById('status').textContent = '等待中';
            
            // 重置进度条
            document.getElementById('training-progress').style.width = '0%';
            
            // 移除预警结果（如果存在）
            const warningResults = document.querySelectorAll('#training-status .status-item');
            if (warningResults.length > 3) { // 原本有3status-item
                warningResults[3].remove();
            }
            
            // 可选：是否要清除训练历史
            if (confirm('是否同时清除训练历史记录？')) {
                document.getElementById('training-history').innerHTML = `
                    <div class="no-history">暂无训练历史记录</div>
                `;
            }
            
            // 重置任务ID（可选）
            if (confirm('是否重置任务ID？')) {
                currentTaskId = 0;
            }
            
            // 重置所有复选框
            document.querySelectorAll('#independent-features input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        });

        // 修改开始训练的处理函数
        document.getElementById('start-training').addEventListener('click', async function() {
            try {
                // 更新初始状态
                document.getElementById('taskId').textContent = ++currentTaskId;
                document.getElementById('elapsedTime').textContent = '0秒';
                document.getElementById('status').textContent = '执行中';
                document.getElementById('training-progress').style.width = '0%';

                // 模拟进度条
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += 2;
                    if (progress <= 100) {
                        document.getElementById('training-progress').style.width = progress + '%';
                        document.getElementById('elapsedTime').textContent = Math.floor(progress/10) + '秒';
                    }
                }, 200);

                // 计算评级和额度（固定结果）
                setTimeout(() => {
                    clearInterval(progressInterval);
                    
                    // 更新状态为完成
                    document.getElementById('training-progress').style.width = '100%';
                    document.getElementById('status').textContent = '已完成';

                    // 固定使用最好的评级
                    const rating = 'AAA';
                    const amount = 800; // 固定的贷款额度
                    
                    // 获取评级说明
                    const descriptions = {
                        'AAA': '最高信用等级，设备状况优秀，财务状况稳健',
                        'AA': '信用等级很高，设备运营良好，财务表现稳定',
                        'A': '信用等级较高，设备状况正常，财务状况良好',
                        'BBB': '信用等级一般，设备需要关注，财务状况尚可',
                        'BB': '信用等级较低，设备和财务状况都需要改善'
                    };

                    // 获取评级颜色
                    const colors = {
                        'AAA': '#2e7d32',
                        'AA': '#1976d2',
                        'A': '#ff9800',
                        'BBB': '#f57c00',
                        'BB': '#d32f2f'
                    };

                    // 添加评级结果到状态区域
                    const statusDiv = document.getElementById('training-status');
                    const ratingHtml = `
                        <div class="status-item">
                            <span class="status-label">企业综合评级:</span>
                            <span class="status-value" style="color: ${colors[rating]}">${rating}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">建议放款额度:</span>
                            <span class="status-value">${amount}万元</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">评估说明:</span>
                            <span class="status-value">${descriptions[rating]}</span>
                        </div>
                    `;
                    statusDiv.insertAdjacentHTML('beforeend', ratingHtml);
                }, 5000);

            } catch (error) {
                console.error('训练过程出错:', error);
            }
        });

        function validateInputs() {
            // 获取所有必填字段
            const nodeCount = document.getElementById('node-count').value;
            const minData = document.getElementById('min-data').value;
            const epochs = document.getElementById('epochs').value;
            const learningRate = document.getElementById('learning-rate').value;
            const modelType = document.getElementById('model-type').value;
            const hiddenLayers = document.getElementById('hidden-layers').value;
            const privacyBudget = document.getElementById('privacy-budget').value;
            const noiseMechanism = document.getElementById('noise-mechanism').value;
            const dataSensitivity = document.getElementById('data-sensitivity').value;

            // 检查所有字段是否都已填写
            const isValid = nodeCount && minData && epochs && learningRate && 
                           modelType && hiddenLayers && privacyBudget && 
                           noiseMechanism && dataSensitivity;

            // 启用或禁用开始训练按钮
            document.getElementById('start-training').disabled = !isValid;
        }

        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('change', validateInputs);
            element.addEventListener('input', validateInputs);
        });

        // 在页面加载时进行初始验证
        document.addEventListener('DOMContentLoaded', validateInputs);

        // 添加训练历史记录的函数
        function addTrainingHistory(historyData) {
            const historyContainer = document.getElementById('training-history');
            
            // 创建历史记录项
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            
            historyItem.innerHTML = `
                <div class="history-header">
                    <span>任务ID: ${historyData.taskId}</span>
                    <span>${historyData.startTime}</span>
                </div>
                <div class="history-content">
                    <div class="history-detail">
                        <span class="label">执行时长</span>
                        <span class="value">${historyData.duration}</span>
                    </div>
                    <div class="history-detail">
                        <span class="label">数据源</span>
                        <span class="value">${historyData.dataSource}</span>
                    </div>
                    <div class="history-detail">
                        <span class="label">模型类型</span>
                        <span class="value">${historyData.modelType}</span>
                    </div>
                    <div class="history-detail">
                        <span class="label">执行状态</span>
                        <span class="value">${historyData.status}</span>
                    </div>
                    <div class="history-detail">
                        <span class="label">预警结果</span>
                        <span class="value">${historyData.warningResult}</span>
                    </div>
                </div>
            `;
            
            // 将新的历史记录添加到容器的开头
            historyContainer.insertBefore(historyItem, historyContainer.firstChild);
        }

        // 添加切换下拉框显示的函数
        function toggleDropdown() {
            const dropdownContent = document.getElementById('independent-features');
            const arrow = document.querySelector('.dropdown-arrow');
            dropdownContent.classList.toggle('show');
            arrow.style.transform = dropdownContent.classList.contains('show') ? 'rotate(180deg)' : '';
        }

        // 添加更新已选择特征文本的函数
        function updateSelectedFeaturesText() {
            const selectedFeatures = Array.from(
                document.querySelectorAll('#independent-features input[type="checkbox"]:checked')
            ).map(checkbox => checkbox.value);
            
            const selectedText = document.getElementById('selected-features-text');
            if (selectedFeatures.length === 0) {
                selectedText.textContent = '请选择自变量';
            } else {
                selectedText.textContent = `已选择 ${selectedFeatures.length} 个变量`;
            }
        }

        // 添加点击外部关闭下拉框的处理
        document.addEventListener('click', function(e) {
            const dropdown = document.querySelector('.dropdown-checkbox');
            const dropdownContent = document.getElementById('independent-features');
            
            if (!dropdown.contains(e.target) && dropdownContent.classList.contains('show')) {
                dropdownContent.classList.remove('show');
                document.querySelector('.dropdown-arrow').style.transform = '';
            }
        });

        // 添加相关JavaScript函数
        function submitAdjustment() {
            // 显示企业响应区域
            document.querySelector('.enterprise-response').style.display = 'block';
            // 这里可以添加发送调整请求到后端的逻辑
        }

        function acceptAdjustment() {
            alert('企业已接受调整方案');
            document.querySelector('.enterprise-response').style.display = 'none';
            // 更新显示的贷款信息
            updateLoanInfo();
        }

        function rejectAdjustment() {
            alert('企业已拒绝调整方案');
            document.querySelector('.enterprise-response').style.display = 'none';
        }

        function updateLoanInfo() {
            // 更新贷款信息显示
            const newAmount = document.getElementById('new-amount').value;
            const newRate = document.getElementById('new-rate').value;
            document.querySelector('.info-item:nth-child(1) .value').textContent = `¥${Number(newAmount).toLocaleString()}`;
            document.querySelector('.info-item:nth-child(2) .value').textContent = `${newRate}%`;
        }

        // 模拟实时更新设备健康状态
        setInterval(() => {
            // 随机更新温度
            const temp = (38 + Math.random()).toFixed(1);
            document.getElementById('temperature').textContent = `${temp}°C`;
            
            // 随机更新震动
            const vibration = (0.1 + Math.random() * 0.1).toFixed(2);
            document.getElementById('vibration').textContent = `${vibration}g`;
            
            // 更新健康状态
            const healthStatuses = ['健康', '警告', '故障'];
            const randomStatus = healthStatuses[Math.floor(Math.random() * 2)]; // 主要在健康和警告之间切换
            document.getElementById('overall-health').textContent = randomStatus;
        }, 3000);

        // 发送预警通知
        function sendWarningNotice(deviceId, level) {
            alert(`已发送${level === 'severe' ? '严重' : '警告'}级别预警通知，设备ID: ${deviceId}`);
        }

        // 应用贷款调整
        function applyAdjustment() {
            if(confirm('确定要应用这些贷款调整建议吗？')) {
                alert('已应用贷款调整建议，相关通知已发送给企业。');
            }
        }

        // 更新管理措施状态
        function updateAction(checkbox) {
            const actionText = checkbox.parentElement.textContent.trim();
            console.log(`${actionText} ${checkbox.checked ? '已选中' : '已取消'}`);
        }

        // 执行选中的管理措施
        function executeActions() {
            const selectedActions = Array.from(document.querySelectorAll('.action-checkbox input:checked'))
                .map(checkbox => checkbox.parentElement.textContent.trim());
            
            if(selectedActions.length > 0) {
                alert(`正在执行以下措施：\n${selectedActions.join('\n')}`);
            } else {
                alert('请先选择要执行的措施');
            }
        }

        // 模拟实时更新设备状态
        setInterval(() => {
            // 更新温度
            const temp = (70 + Math.random() * 20).toFixed(1);
            document.getElementById('device-temp').textContent = `${temp}°C`;
            
            // 更新震动
            const vibration = (2 + Math.random()).toFixed(1);
            document.getElementById('device-vibration').textContent = `${vibration}g`;
            
            // 更新噪声
            const noise = Math.floor(75 + Math.random() * 15);
            document.getElementById('device-noise').textContent = `${noise}dB`;
            
            // 更新状态指示灯
            updateStatusLights(temp, vibration, noise);
        }, 3000);

        // 更新状态指示灯
        function updateStatusLights(temp, vibration, noise) {
            const tempLight = document.querySelector('.metric-item:nth-child(1) .status-light');
            const vibLight = document.querySelector('.metric-item:nth-child(2) .status-light');
            const noiseLight = document.querySelector('.metric-item:nth-child(3) .status-light');
            
            tempLight.className = 'status-light ' + (temp > 80 ? 'severe' : temp > 75 ? 'warning' : 'normal');
            vibLight.className = 'status-light ' + (vibration > 2.8 ? 'warning' : 'normal');
            noiseLight.className = 'status-light ' + (noise > 80 ? 'warning' : 'normal');
        }

        // 上报风险到银行
        function reportToBank(enterpriseId, level) {
            const riskLevels = {
                'severe': '高风险',
                'warning': '中等风险'
            };
            alert(`已将${riskLevels[level]}情况上报给上级银行\n企业ID: ${enterpriseId}`);
        }

        // 生成风险报告
        function generateRiskReport() {
            alert('正在生成机构风险评估报告，将自动发送给风险管理部门');
        }

        // 显示调整对话框
        function showAdjustmentDialog(enterpriseId, currentAmount, currentRate) {
            const newAmount = prompt(`请输入新的贷款额度（当前：${currentAmount}万）：`);
            if (newAmount === null) return;
            
            const newRate = prompt(`请输入新的利率（当前：${currentRate}%）：`);
            if (newRate === null) return;
            
            if (confirm(`确认将企业${enterpriseId}的贷款条件调整为：\n额度：${newAmount}万\n利率：${newRate}%`)) {
                alert('调整申请已提交，等待企业确认');
            }
        }

        // 应用系统建议
        function applyRecommendation(enterpriseId) {
            if (confirm(`确认对企业${enterpriseId}应用系统建议的调整方案？`)) {
                alert('调整方案已发送给企业确认');
            }
        }

        // 显示交互详情
        function showInteractionDetail(interactionId) {
            alert(`显示交互记录详情：${interactionId}`);
            // 这里可以添加显示详细信息的逻辑
        }

        // 查看合同详情
        function viewContractDetail(contractId) {
            alert(`显示合同详情：${contractId}`);
            // 这里可以添加显示合同详细信息的逻辑
        }

        // 添加企业用户的新功能函数
        function submitFinancingRequest() {
            const amount = document.getElementById('requestAmount').value;
            const term = document.getElementById('requestTerm').value;
            const purpose = document.getElementById('requestPurpose').value;
            
            if (!amount || !term || !purpose) {
                alert('请填写完整的申请信息');
                return;
            }
            
            alert(`融资申请已提交：\n金额：${amount}万元\n期限：${term}个月\n用途：${purpose}`);
        }

        // 标准模型按钮点击事件
        document.getElementById('standard-model-btn').addEventListener('click', function() {
            document.getElementById('training-status').style.display = 'block';
            document.querySelector('.action-buttons').style.display = 'block';
            document.getElementById('start-training').disabled = false;
        });

        // 取消按钮点击事件
        document.getElementById('cancel-config').addEventListener('click', function() {
            document.getElementById('start-training').disabled = true;
            document.getElementById('taskId').textContent = '--';
            document.getElementById('elapsedTime').textContent = '--';
            document.getElementById('status').textContent = '等待中';
            document.getElementById('training-progress').style.width = '0%';
            
            // 移除评级结果（如果存在）
            const oldResult = document.querySelector('.rating-result');
            if (oldResult) {
                oldResult.remove();
            }
        });

        // 辅助函数：根据准确率确定评级
        function determineRating(accuracy) {
            if (accuracy >= 0.9) return 'AAA';
            if (accuracy >= 0.8) return 'AA';
            if (accuracy >= 0.7) return 'A';
            if (accuracy >= 0.6) return 'BBB';
            return 'BB';
        }

        // 辅助函数：计算建议放款额度
        function calculateLoanAmount(rating) {
            const ranges = {
                'AAA': [500, 1000],
                'AA': [300, 500],
                'A': [100, 300],
                'BBB': [50, 100],
                'BB': [0, 50]
            };
            const range = ranges[rating];
            return Math.floor(Math.random() * (range[1] - range[0] + 1) + range[0]);
        }

        // 辅助函数：获取评级颜色
        function getRatingColor(rating) {
            const colors = {
                'AAA': '#2e7d32',
                'AA': '#1976d2',
                'A': '#ff9800',
                'BBB': '#f57c00',
                'BB': '#d32f2f'
            };
            return colors[rating] || '#333';
        }

        // 辅助函数：获取评级说明
        function getRatingDescription(rating) {
            const descriptions = {
                'AAA': '最高信用等级，设备状况优秀，财务状况稳健',
                'AA': '信用等级很高，设备运营良好，财务表现稳定',
                'A': '信用等级较高，设备状况正常，财务状况良好',
                'BBB': '信用等级一般，设备需要关注，财务状况尚可',
                'BB': '信用等级较低，设备和财务状况都需要改善'
            };
            return descriptions[rating] || '';
        }

        // 联邦学习信用凭证训练
        document.getElementById('start-credit-training').addEventListener('click', function() {
            const creditTrainingStatus = document.getElementById('credit-training-status');
            const creditResult = document.getElementById('credit-result');
            const creditTaskId = document.getElementById('creditTaskId');
            const creditStatus = document.getElementById('creditStatus');
            const creditTrainingProgress = document.getElementById('credit-training-progress');

            // 更新初始状态
            creditTaskId.textContent = ++currentTaskId;
            creditStatus.textContent = '执行中';
            creditTrainingStatus.style.display = 'block';
            creditTrainingProgress.style.width = '0%';

            // 模拟进度条
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 5;
                if (progress <= 100) {
                    creditTrainingProgress.style.width = progress + '%';
                } else {
                    clearInterval(progressInterval);
                }
            }, 100);

            // 直接生成确定性的结果
            setTimeout(() => {
                // 更新状态为完成
                creditTrainingProgress.style.width = '100%';
                creditStatus.textContent = '已完成';

                // 显示结果 - 固定的正面结果
                document.getElementById('device-damage-rate').textContent = '0%';
                document.getElementById('comprehensive-index').textContent = '90';
                document.getElementById('suggested-loan-amount').textContent = '500万';
                creditResult.style.display = 'block';
            }, 2000);
        });

        function startTraining() {
            // 训练逻辑
            document.getElementById('training-task-status').textContent = '训练中...';
            
            // 模拟训练进度
            let progress = 0;
            const progressBar = document.getElementById('credit-training-progress');
            const progressInterval = setInterval(() => {
                progress += 10;
                progressBar.style.width = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    document.getElementById('training-task-status').textContent = '已完成';
                    document.getElementById('device-damage-rate').textContent = '0%';
                    document.getElementById('comprehensive-index').textContent = '90';
                    document.getElementById('suggested-loan-amount').textContent = '500万';
                }
            }, 500);
        }
    </script>
</body>
</html>
